local TweenService = game:GetService("TweenService")
local Lighting = game:GetService("Lighting")
local Players = game:GetService("Players")

-- Create a ScreenGui
local screenGui = Instance.new("ScreenGui")
screenGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")

-- Create a TextButton
local textButton = Instance.new("TextButton")
textButton.Size = UDim2.new(0, 200, 0, 50) -- Size of the button
textButton.Position = UDim2.new(0.5, -100, 0.5, -25) -- Centered position
textButton.Text = "Click Me!" -- Button text
textButton.BackgroundColor3 = Color3.fromRGB(255, 0, 0) -- Button background color (red)
textButton.TextColor3 = Color3.fromRGB(255, 255, 255) -- Text color (white)
textButton.Parent = screenGui

-- Load the audio asset (replace with your audio ID)
local audioId = "rbxassetid://5129686200" -- Replace with your audio ID
local sound = Instance.new("Sound")
sound.SoundId = audioId
sound.Parent = game.Workspace

-- Function to handle button click
local function onButtonClick()
    -- Play the audio
    sound:Play()

    -- Wait for 2 seconds
    wait(2.15)

    -- Create and configure the sphere
    local sphere = Instance.new("Part")
    sphere.Shape = Enum.PartType.Ball
    sphere.Size = Vector3.new(5, 5, 5)
    sphere.Position = game.Players.LocalPlayer.Character.HumanoidRootPart.Position
    sphere.Material = Enum.Material.ForceField
    sphere.Anchored = true
    sphere.CanCollide = false
    sphere.BrickColor = BrickColor.new("Black")
    sphere.Parent = game.Workspace

    -- Create and configure the ColorCorrectionEffect
    local colorCorrection = Instance.new("ColorCorrectionEffect")
    colorCorrection.Name = "WhiteOutEffect"
    colorCorrection.Parent = Lighting

    -- Tween the ColorCorrectionEffect properties to make everything white
    local colorCorrectionTweenInfo = TweenInfo.new(
        1.5, -- Duration of the tween (1.5 seconds)
        Enum.EasingStyle.Linear, -- Easing style
        Enum.EasingDirection.InOut -- Easing direction
    )

    local colorCorrectionGoal = {
        Saturation = -1, -- Reduce saturation to make colors less vibrant
        Contrast = 1, -- Increase contrast
        Brightness = 0.5 -- Adjust brightness to make it brighter
    }

    local colorCorrectionTween = TweenService:Create(colorCorrection, colorCorrectionTweenInfo, colorCorrectionGoal)
    colorCorrectionTween:Play()

    -- Create a tween for the sphere's expansion
    local sphereTweenInfo = TweenInfo.new(
        1.5, -- Duration of the tween (1.5 seconds)
        Enum.EasingStyle.Linear, -- Easing style
        Enum.EasingDirection.InOut -- Easing direction
    )

    local sphereGoal = {Size = Vector3.new(500, 500, 500)} -- Target size of the sphere

    local sphereTween = TweenService:Create(sphere, sphereTweenInfo, sphereGoal)
    sphereTween:Play()

    -- Anchor all players except the Time Stop user
    local timeStopUser = game.Players.LocalPlayer
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= timeStopUser and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local humanoidRootPart = player.Character:FindFirstChild("HumanoidRootPart")
            humanoidRootPart.Anchored = true
            -- Anchor limbs
            for _, limb in pairs(player.Character:GetChildren()) do
                if limb:IsA("Part") and limb.Name ~= "HumanoidRootPart" then
                    limb.Anchored = true
                end
            end
        end
    end

    -- Wait for the sphere tween to complete
    sphereTween.Completed:Connect(function()
        print("Sphere tween completed")
        sphere:Destroy() -- Ensure sphere is destroyed

        -- Unanchor all players (if needed) after the effect
        for _, player in pairs(Players:GetPlayers()) do
            if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                local humanoidRootPart = player.Character:FindFirstChild("HumanoidRootPart")
                humanoidRootPart.Anchored = false
                -- Unanchor limbs
                for _, limb in pairs(player.Character:GetChildren()) do
                    if limb:IsA("Part") and limb.Name ~= "HumanoidRootPart" then
                        limb.Anchored = false
                    end
                end
            end
        end
    end)
    
    -- Wait for the ColorCorrectionEffect tween to complete
    colorCorrectionTween.Completed:Connect(function()
        print("ColorCorrectionEffect tween completed")
        -- Optionally, you can remove the ColorCorrectionEffect here if needed
        -- colorCorrection:Destroy() -- Uncomment if you want to remove it
    end)
end

-- Connect the button click to the function
textButton.MouseButton1Click:Connect(onButtonClick)
